!function(e,r){"object"==typeof exports&&"undefined"!=typeof module?r(exports,require("react")):"function"==typeof define&&define.amd?define(["exports","react"],r):r((e="undefined"!=typeof globalThis?globalThis:e||self).ReactHookForm={},e.React)}(this,(function(e,r){"use strict";function t(e){if(e&&e.__esModule)return e;var r=Object.create(null);return e&&Object.keys(e).forEach((function(t){if("default"!==t){var n=Object.getOwnPropertyDescriptor(e,t);Object.defineProperty(r,t,n.get?n:{enumerable:!0,get:function(){return e[t]}})}})),r.default=e,Object.freeze(r)}var n=t(r),s=e=>"checkbox"===e.type,c=e=>null==e;const u=e=>"object"==typeof e;var a=e=>!c(e)&&!Array.isArray(e)&&u(e)&&!(e instanceof Date),i=e=>e.substring(0,e.search(/.\d/))||e,o=(e,r)=>[...e].some(e=>i(r)===e),l=e=>e.filter(Boolean),f=e=>void 0===e,d=(e,r,t)=>{if(a(e)&&r){const n=l(r.split(/[,[\].]+?/)).reduce((e,r)=>c(e)?e:e[r],e);return f(n)||n===e?f(e[r])?t:e[r]:n}};const b="blur",y="change",g="onBlur",m="onChange",h="onSubmit",v="onTouched",p="all",x="max",O="min",j="maxLength",w="minLength",A="pattern",k="required",F="validate";var V=(e,r)=>{const t=Object.assign({},e);return delete t[r],t};const _=n.createContext(null);_.displayName="RHFContext";const R=()=>n.useContext(_);var C=(e,r,t,n,s=!0)=>e?new Proxy(r,{get:(e,r)=>{if(r in e)return t.current[r]!==p&&(t.current[r]=!s||p),n&&(n.current[r]=!0),e[r]}}):r,S=e=>a(e)&&!Object.keys(e).length,D=(e,r,t)=>{const n=V(e,"name");return S(n)||Object.keys(n).length>=Object.keys(r).length||Object.keys(n).find(e=>r[e]===(!t||p))},E=e=>Array.isArray(e)?e:[e],B="undefined"!=typeof window&&void 0!==window.HTMLElement&&"undefined"!=typeof document;const M=B?"Proxy"in window:"undefined"!=typeof Proxy;function T(e){const{control:r,name:t}=e||{},s=R(),{formStateRef:c,subjectsRef:u,readFormStateRef:a}=r||s.control,i=n.useRef(t);i.current=t;const[o,l]=n.useState(c.current),f=n.useRef({isDirty:!1,dirtyFields:!1,touchedFields:!1,isValidating:!1,isValid:!1,errors:!1});return n.useEffect(()=>{const e=u.current.state.subscribe({next:e=>(!i.current||!e.name||E(i.current).includes(e.name))&&D(e,f.current)&&l(Object.assign(Object.assign({},c.current),e))});return()=>e.unsubscribe()},[]),C(M,o,a,f,!1)}function N({name:e,rules:r,defaultValue:t,control:c,shouldUnregister:u}){const i=R(),{defaultValuesRef:l,register:g,fieldsRef:m,unregister:h,namesRef:v,subjectsRef:p,shouldUnmount:x,inFieldArrayActionRef:O}=c||i.control,j=o(v.current.array,e),w=d(m.current,e),[A,k]=n.useState(!j&&w&&w._f?w._f.value:j||f(d(l.current,e))?t:d(l.current,e)),{onChange:F,onBlur:V,ref:_}=g(e,Object.assign(Object.assign({},r),{value:A})),C=T({control:c||i.control,name:e});return n.useEffect(()=>{const r=p.current.control.subscribe({next:r=>(!r.name||e===r.name)&&k(d(r.values,e))});return()=>{r.unsubscribe();const t=x||u;if(j?t&&!O.current:t)h(e);else{const r=d(m.current,e);r&&r._f&&(r._f.mount=!1)}}},[e]),{field:{onChange:r=>{const t=(e=>a(e)&&e.target?s(e.target)?e.target.checked:e.target.value:e)(r);k(t),F({target:{value:t,name:e},type:y})},onBlur:()=>{V({target:{name:e},type:b})},name:e,value:A,ref:e=>e&&_({focus:()=>e.focus&&e.focus()})},formState:C,fieldState:{invalid:!!d(C.errors,e),isDirty:!!d(C.dirtyFields,e),isTouched:!!d(C.touchedFields,e),error:d(C.errors,e)}}}var I=(e,r,t,n,s)=>r?Object.assign(Object.assign({},t[e]),{types:Object.assign(Object.assign({},t[e]&&t[e].types?t[e].types:{}),{[n]:s||!0})}):{},P=e=>/^\w*$/.test(e),$=e=>l(e.replace(/["|']|\]/g,"").split(/\.|\[/));function L(e,r,t){let n=-1;const s=P(r)?[r]:$(r),c=s.length,u=c-1;for(;++n<c;){const r=s[n];let c=t;if(n!==u){const t=e[r];c=a(t)||Array.isArray(t)?t:isNaN(+s[n+1])?{}:[]}e[r]=c,e=e[r]}return e}const U=(e,r,t)=>{for(const n of t||Object.keys(e)){const t=d(e,n);if(t){const e=t._f,n=V(t,"_f");if(e&&r(e.name)){if(e.ref.focus&&f(e.ref.focus()))break;if(e.refs){e.refs[0].focus();break}}else a(n)&&U(n,r)}}},W=(e,r={})=>{for(const t in e.current){const n=e.current[t];if(n&&!c(r)){const e=n._f,s=V(n,"_f");L(r,t,e&&e.ref?e.ref.disabled||e.refs&&e.refs.every(e=>e.disabled)?void 0:e.value:Array.isArray(n)?[]:{}),s&&W({current:s},r[t])}}return r};var q=()=>{const e="undefined"==typeof performance?Date.now():1e3*performance.now();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,r=>{const t=(16*Math.random()+e)%16|0;return("x"==r?t:3&t|8).toString(16)})},H=(e=[],r)=>e.map(e=>Object.assign({[r]:e&&e[r]||q()},e)),z=e=>c(e)||!u(e);function G(e,r,t){if(z(e)||z(r)||e instanceof Date||r instanceof Date)return e===r;if(!n.isValidElement(e)){const n=Object.keys(e),s=Object.keys(r);if(n.length!==s.length)return!1;for(const s of n){const n=e[s];if(!t||"ref"!==s){const e=r[s];if((a(n)||Array.isArray(n))&&(a(e)||Array.isArray(e))?!G(n,e,t):n!==e)return!1}}}return!0}function J(e,r,t,n,s){let c=-1;for(;++c<e.length;){for(const n in e[c])Array.isArray(e[c][n])?(!t[c]&&(t[c]={}),t[c][n]=[],J(e[c][n],d(r[c]||{},n,[]),t[c][n],t[c],n)):G(d(r[c]||{},n),e[c][n])?L(t[c]||{},n):t[c]=Object.assign(Object.assign({},t[c]),{[n]:!0});n&&!t.length&&delete n[s]}return t}var K=(e,r,t)=>function e(r,t){if(z(r)||z(t))return t;for(const n in t){const s=r[n],c=t[n];try{r[n]=a(s)&&a(c)||Array.isArray(s)&&Array.isArray(c)?e(s,c):c}catch(e){}}return r}(J(e,r,t.slice(0,e.length)),J(r,e,t.slice(0,e.length)));function Q(e,r){return[...e,...E(r)]}var X=e=>Array.isArray(e)?Array(e.length).fill(void 0):void 0;function Y(e,r,t){return[...e.slice(0,r),...E(t),...e.slice(r)]}var Z=(e,r,t)=>Array.isArray(e)?(f(e[t])&&(e[t]=void 0),e.splice(t,0,e.splice(r,1)[0]),e):[];function ee(e,r){return[...E(r),...e]}var re=(e,r)=>f(r)?[]:function(e,r){let t=0;const n=[...e];for(const e of r)n.splice(e-t,1),t++;return l(n).length?n:[]}(e,E(r).sort((e,r)=>e-r)),te=(e,r,t)=>{e[r]=[e[t],e[t]=e[r]][0]},ne=e=>"boolean"==typeof e;function se(e,r){const t=P(r)?[r]:$(r),n=1==t.length?e:function(e,r){const t=r.slice(0,-1).length;let n=0;for(;n<t;)e=f(e)?n++:e[r[n++]];return e}(e,t),s=t[t.length-1];let c;n&&delete n[s];for(let r=0;r<t.slice(0,-1).length;r++){let n,s=-1;const u=t.slice(0,-(r+1)),i=u.length-1;for(r>0&&(c=e);++s<u.length;){const r=u[s];n=n?n[r]:e[r],i===s&&(a(n)&&S(n)||Array.isArray(n)&&!n.filter(e=>a(e)&&!S(e)||ne(e)).length)&&(c?delete c[r]:delete e[r]),c=n}}return e}var ce=e=>"file"===e.type,ue=e=>"select-multiple"===e.type,ae=e=>"radio"===e.type;const ie={value:!1,isValid:!1},oe={value:!0,isValid:!0};var le=e=>{if(Array.isArray(e)){if(e.length>1){const r=e.filter(e=>e&&e.checked&&!e.disabled).map(e=>e.value);return{value:r,isValid:!!r.length}}return e[0].checked&&!e[0].disabled?e[0].attributes&&!f(e[0].attributes.value)?f(e[0].value)||""===e[0].value?oe:{value:e[0].value,isValid:!0}:oe:ie}return ie},fe=(e,{valueAsNumber:r,valueAsDate:t,setValueAs:n})=>f(e)?e:r?""===e?NaN:+e:t?new Date(e):n?n(e):e;const de={isValid:!1,value:null};var be=e=>Array.isArray(e)?e.reduce((e,r)=>r&&r.checked&&!r.disabled?{isValid:!0,value:r.value}:e,de):de;function ye(e){if(e&&e._f){const t=e._f.ref;if(t.disabled)return;return ce(t)?t.files:ae(t)?be(e._f.refs).value:ue(t)?(r=t.options,[...r].filter(({selected:e})=>e).map(({value:e})=>e)):s(t)?le(e._f.refs).value:fe(f(t.value)?e._f.ref.value:t.value,e._f)}var r}var ge=(e,r,t)=>{const n={};for(const t of e){const e=d(r,t);e&&L(n,t,e._f)}return{criteriaMode:t,names:[...e],fields:n}},me=e=>"function"==typeof e,he=e=>"string"==typeof e,ve=e=>he(e)||n.isValidElement(e),pe=e=>e instanceof RegExp;function xe(e,r,t="validate"){if(ve(e)||Array.isArray(e)&&e.every(ve)||ne(e)&&!e)return{type:t,message:ve(e)?e:"",ref:r}}var Oe=e=>a(e)&&!pe(e)?e:{value:e,message:""},je=async({_f:{ref:e,refs:r,required:t,maxLength:n,minLength:u,min:i,max:o,pattern:l,validate:f,name:d,value:b,valueAsNumber:y,mount:g}},m)=>{if(!g)return{};const h={},v=ae(e),p=s(e),V=v||p,_=(y||ce(e))&&!e.value||""===b||Array.isArray(b)&&!b.length,R=I.bind(null,d,m,h),C=(r,t,n,s=j,c=w)=>{const u=r?t:n;h[d]=Object.assign({type:r?s:c,message:u,ref:e},R(r?s:c,u))};if(t&&(!v&&!p&&(_||c(b))||ne(b)&&!b||p&&!le(r).isValid||v&&!be(r).isValid)){const{value:n,message:s}=ve(t)?{value:!!t,message:t}:Oe(t);if(n&&(h[d]=Object.assign({type:k,message:s,ref:V?(r||[])[0]||{}:e},R(k,s)),!m))return h}if(!(c(i)&&c(o)||""===b)){let r,t;const n=Oe(o),s=Oe(i);if(isNaN(b)){const c=e.valueAsDate||new Date(b);he(n.value)&&(r=c>new Date(n.value)),he(s.value)&&(t=c<new Date(s.value))}else{const u=e.valueAsNumber||parseFloat(b);c(n.value)||(r=u>n.value),c(s.value)||(t=u<s.value)}if((r||t)&&(C(!!r,n.message,s.message,x,O),!m))return h}if(he(b)&&!_&&(n||u)){const e=Oe(n),r=Oe(u),t=!c(e.value)&&b.length>e.value,s=!c(r.value)&&b.length<r.value;if((t||s)&&(C(t,e.message,r.message),!m))return h}if(he(b)&&l&&!_){const{value:r,message:t}=Oe(l);if(pe(r)&&!b.match(r)&&(h[d]=Object.assign({type:A,message:t,ref:e},R(A,t)),!m))return h}if(f){const t=V&&r?r[0]:e;if(me(f)){const e=xe(await f(b),t);if(e&&(h[d]=Object.assign(Object.assign({},e),R(F,e.message)),!m))return h}else if(a(f)){let e={};for(const[r,n]of Object.entries(f)){if(!S(e)&&!m)break;const s=xe(await n(b),t,r);s&&(e=Object.assign(Object.assign({},s),R(r,s.message)),m&&(h[d]=e))}if(!S(e)&&(h[d]=Object.assign({ref:t},e),!m))return h}}return h},we=e=>({isOnSubmit:!e||e===h,isOnBlur:e===g,isOnChange:e===m,isOnAll:e===p,isOnTouch:e===v}),Ae=e=>e instanceof HTMLElement;class ke{constructor(){this.tearDowns=[]}add(e){this.tearDowns.push(e)}unsubscribe(){for(const e of this.tearDowns)e();this.tearDowns=[]}}class Fe{constructor(e,r){this.observer=e,this.closed=!1,r.add(()=>this.closed=!0)}next(e){this.closed||this.observer.next(e)}}class Ve{constructor(){this.observers=[]}next(e){for(const r of this.observers)r.next(e)}subscribe(e){const r=new ke,t=new Fe(e,r);return this.observers.push(t),r}unsubscribe(){this.observers=[]}}const _e="undefined"==typeof window;e.Controller=e=>e.render(N(e)),e.FormProvider=e=>n.createElement(_.Provider,{value:V(e,"children")},e.children),e.appendErrors=I,e.get=d,e.set=L,e.useController=N,e.useFieldArray=({control:e,name:r,keyName:t="id",shouldUnregister:s})=>{const c=R(),u=n.useRef(""),a=n.useRef(!1),{getIsDirty:o,namesRef:f,fieldsRef:b,defaultValuesRef:y,formStateRef:g,subjectsRef:m,readFormStateRef:h,updateIsValid:v,fieldArrayDefaultValuesRef:p,unregister:x,shouldUnmount:O,inFieldArrayActionRef:j,register:w}=e||c.control,[A,k]=n.useState(H((d(b.current,r)&&a.current?d(W(b),r):d(p.current,i(r))?d(p.current,r):d(y.current,r))||[],t));L(p.current,r,[...A]),f.current.array.add(r);const F=e=>e.map((e={})=>V(e,t)),_=()=>{const e=d(W(b),r,[]);return H(d(p.current,r,[]).map((r,t)=>Object.assign(Object.assign({},r),e[t])),t)},C=(e,t)=>t&&!t.shouldFocus?t.focusName||`${r}.${t.focusIndex}.`:`${r}.${e}.`,S=(e=[])=>k(H(e,t)),D=e=>!l(d(e,r,[])).length&&se(e,r),B=(e,t,n=[],s=!0)=>{if(j.current=!0,d(b.current,r)){const n=e(d(b.current,r),t.argA,t.argB);s&&L(b.current,r,n)}if(Array.isArray(d(g.current.errors,r))){const n=e(d(g.current.errors,r),t.argA,t.argB);s&&L(g.current.errors,r,n),D(g.current.errors)}if(h.current.touchedFields&&d(g.current.touchedFields,r)){const n=e(d(g.current.touchedFields,r),t.argA,t.argB);s&&L(g.current.touchedFields,r,n),D(g.current.touchedFields)}(h.current.dirtyFields||h.current.isDirty)&&(L(g.current.dirtyFields,r,K(F(n),d(y.current,r,[]),d(g.current.dirtyFields,r,[]))),n&&L(g.current.dirtyFields,r,K(F(n),d(y.current,r,[]),d(g.current.dirtyFields,r,[]))),D(g.current.dirtyFields)),m.current.state.next({isDirty:o(r,F(n)),errors:g.current.errors,isValid:g.current.isValid})},M=(e,t=0,n="")=>e.forEach((e,s)=>{const c=`${n||r}.${n?s:t+s}`;z(e)?w(c,{value:e}):Object.entries(e).forEach(([e,r])=>{const t=c+"."+e;Array.isArray(r)?M(r,s,t):w(t,{value:z(r)?r:Object.assign({},r)})})});return n.useEffect(()=>{if(j.current=!1,f.current.watchAll)m.current.state.next({});else for(const e of f.current.watch)if(r.startsWith(e)){m.current.state.next({});break}m.current.watch.next({name:r,values:W(b)}),u.current&&U(b.current,e=>e.startsWith(u.current)),u.current="",m.current.array.next({name:r,values:F([...A])}),h.current.isValid&&v()},[A,r]),n.useEffect(()=>{const e=m.current.array.subscribe({next({name:e,values:t,isReset:n}){n&&(se(b.current,e||r),e?L(p.current,e,t):p.current=t,S(d(p.current,r)))}});return!d(b.current,r)&&L(b.current,r,[]),a.current=!0,()=>{if(e.unsubscribe(),O||s)x(r),se(p.current,r);else{const e=d(W(b),r);e&&L(p.current,r,e)}}},[]),{swap:n.useCallback((e,r)=>{const t=_();te(t,e,r),B(te,{argA:e,argB:r},t,!1),S(t)},[r]),move:n.useCallback((e,r)=>{const t=_();Z(t,e,r),S(t),B(Z,{argA:e,argB:r},t,!1)},[r]),prepend:n.useCallback((e,r)=>{const t=E(e),n=ee(_(),t);S(n),B(ee,{argA:X(e)},n),M(t),u.current=C(0,r)},[r]),append:n.useCallback((e,r)=>{const t=E(e),n=Q(_(),t),s=n.length-t.length;S(n),B(Q,{argA:X(e)},n,!1),M(t,s),u.current=C(s,r)},[r]),remove:n.useCallback(e=>{const r=re(_(),e);S(r),B(re,{argA:e},r)},[r]),insert:n.useCallback((e,r,t)=>{const n=E(r),s=Y(_(),e,n);S(s),B(Y,{argA:e,argB:X(r)},s),M(n,e),u.current=C(e,t)},[r]),fields:A}},e.useForm=function({mode:e=h,reValidateMode:r=m,resolver:t,context:u,defaultValues:y={},shouldFocusError:g=!0,shouldUnregister:v,criteriaMode:x}={}){const[O,j]=n.useState({isDirty:!1,isValidating:!1,dirtyFields:{},isSubmitted:!1,submitCount:0,touchedFields:{},isSubmitting:!1,isSubmitSuccessful:!1,isValid:!1,errors:{}}),w=n.useRef({isDirty:!M,dirtyFields:!M,touchedFields:!M,isValidating:!M,isValid:!M,errors:!M}),A=n.useRef(t),k=n.useRef(O),F=n.useRef({}),_=n.useRef(y),R=n.useRef({}),T=n.useRef(u),N=n.useRef(!1),I=n.useRef(!1),P=n.useRef({watch:new Ve,control:new Ve,array:new Ve,state:new Ve}),$=n.useRef({mount:new Set,unMount:new Set,array:new Set,watch:new Set,watchAll:!1}),q=we(e),H=x===p;A.current=t,T.current=u;const J=e=>$.current.watchAll||$.current.watch.has(e)||$.current.watch.has((e.match(/\w+/)||[])[0]),Q=n.useCallback(async(e,r,n,s,c,u)=>{const a=d(k.current.errors,r),i=!!w.current.isValid&&(t?c:await te(F.current,!0));if(n?L(k.current.errors,r,n):se(k.current.errors,r),(u||(n?!G(a,n,!0):a)||!S(s)||k.current.isValid!==i)&&!e){const e=Object.assign(Object.assign({},s),{isValid:!!i,errors:k.current.errors,name:r});k.current=Object.assign(Object.assign({},k.current),e),P.current.state.next(u?{name:r}:e)}P.current.state.next({isValidating:!1})},[]),X=n.useCallback((e,r,t={},n,u)=>{u&&Oe(e);const a=d(F.current,e);if(a){const u=a._f;if(u){const a=B&&Ae(u.ref)&&c(r)?"":r;if(u.value=fe(r,u),ae(u.ref)?(u.refs||[]).forEach(e=>e.checked=e.value===a):ce(u.ref)&&!he(a)?u.ref.files=a:ue(u.ref)?[...u.ref.options].forEach(e=>e.selected=a.includes(e.value)):s(u.ref)&&u.refs?u.refs.length>1?u.refs.forEach(e=>e.checked=Array.isArray(a)?!!a.find(r=>r===e.value):a===e.value):u.refs[0].checked=!!a:u.ref.value=a,n){const t=W(F);L(t,e,r),P.current.control.next({values:Object.assign(Object.assign({},_.current),t),name:e})}(t.shouldDirty||t.shouldTouch)&&Z(e,a,t.shouldTouch),t.shouldValidate&&ne(e)}else a._f={ref:{name:e,value:r},value:r}}},[]),Y=n.useCallback((e,r)=>{const t=W(F);return e&&r&&L(t,e,r),!G(t,_.current)},[]),Z=n.useCallback((e,r,t,n=!0)=>{const s={name:e};let c=!1;if(w.current.isDirty){const e=k.current.isDirty;k.current.isDirty=Y(),s.isDirty=k.current.isDirty,c=e!==s.isDirty}if(w.current.dirtyFields&&!t){const t=d(k.current.dirtyFields,e);!G(d(_.current,e),r)?L(k.current.dirtyFields,e,!0):se(k.current.dirtyFields,e),s.dirtyFields=k.current.dirtyFields,c=c||t!==d(k.current.dirtyFields,e)}const u=d(k.current.touchedFields,e);return t&&!u&&(L(k.current.touchedFields,e,t),s.touchedFields=k.current.touchedFields,c=c||w.current.touchedFields&&u!==t),c&&n&&P.current.state.next(s),c?s:{}},[]),ee=n.useCallback(async(e,r)=>{const t=(await je(d(F.current,e),H))[e];return Q(r,e,t),f(t)},[H]),re=n.useCallback(async e=>{const{errors:r}=await A.current(W(F),T.current,ge($.current.mount,F.current,x));if(e)for(const t of e){const e=d(r,t);e?L(k.current.errors,t,e):se(k.current.errors,t)}else k.current.errors=r;return r},[x]),te=async(e,r,t={valid:!0})=>{for(const n in e){const s=e[n];if(s){const e=s._f,n=V(s,"_f");if(e){const n=await je(s,H);if(r){if(n[e.name]){t.valid=!1;break}}else n[e.name]?L(k.current.errors,e.name,n[e.name]):se(k.current.errors,e.name)}n&&await te(n,r,t)}}return t.valid},ne=n.useCallback(async(e,r={})=>{const n=E(e);let s;if(P.current.state.next({isValidating:!0}),t){const r=await re(f(e)?e:n);s=e?n.every(e=>!d(r,e)):S(r)}else e?s=(await Promise.all(n.filter(e=>d(F.current,e)).map(async e=>await ee(e,!0)))).every(Boolean):(await te(F.current),s=S(k.current.errors));return P.current.state.next(Object.assign(Object.assign({},he(e)?{name:e}:{}),{errors:k.current.errors,isValidating:!1})),r.shouldFocus&&!s&&U(F.current,e=>d(k.current.errors,e),n),w.current.isValid&&oe(),s},[re,ee]),ie=(e,r)=>{const t=d(F.current,e);if(t){const n=f(t._f.value),s=n?d(_.current,e):t._f.value;f(s)?n&&(t._f.value=ye(t)):r&&r.defaultChecked?t._f.value=ye(t):o($.current.array,e)?t._f.value=s:X(e,s)}I.current&&w.current.isValid&&oe()},oe=n.useCallback(async(e={})=>{const r=t?S((await A.current(Object.assign(Object.assign({},W(F)),e),T.current,ge($.current.mount,F.current,x))).errors):await te(F.current,!0);r!==k.current.isValid&&P.current.state.next({isValid:r})},[x]),le=n.useCallback((e,r,t)=>Object.entries(r).forEach(([r,n])=>{const s=`${e}.${r}`,c=d(F.current,s);$.current.array.has(e)||!z(n)||c&&!c._f?le(s,n,t):X(s,n,t,!0,!c)}),[ne]),de=n.useCallback(async({type:e,target:n,target:{value:c,type:u}})=>{let a,o,l=n.name;const y=d(F.current,l);if(y){let m=u?ye(y):void 0;m=f(m)?c:m;const h=e===b,{isOnBlur:v,isOnChange:p}=we(r),O=(g=y._f,!(y._f.mount&&g&&(g.required||g.min||g.max||g.maxLength||g.minLength||g.pattern||g.validate)||t||d(k.current.errors,l))||(({isOnBlur:e,isOnChange:r,isOnTouch:t,isTouched:n,isReValidateOnBlur:s,isReValidateOnChange:c,isBlurEvent:u,isSubmitted:a,isOnAll:i})=>!i&&(!a&&t?!(n||u):(a?s:e)?!u:!(a?c:r)||u))(Object.assign({isBlurEvent:h,isTouched:!!d(k.current.touchedFields,l),isSubmitted:k.current.isSubmitted,isReValidateOnBlur:v,isReValidateOnChange:p},q))),j=!h&&J(l);f(m)||(y._f.value=m);const w=Z(l,y._f.value,h,!1),V=!S(w)||j;if(O)return!h&&P.current.watch.next({name:l,type:e,values:be()}),V&&P.current.state.next(j?{name:l}:Object.assign(Object.assign({},w),{name:l}));if(P.current.state.next({isValidating:!0}),t){const{errors:e}=await A.current(W(F),T.current,ge([l],F.current,x));if(a=d(e,l),s(n)&&!a){const r=i(l),t=d(e,r,{});t.type&&t.message&&(a=t),(t||d(k.current.errors,r))&&(l=r)}o=S(e)}else a=(await je(y,H))[l];!h&&P.current.watch.next({name:l,type:e,values:be()}),Q(!1,l,a,w,o,j)}var g},[]),be=e=>{const r=Object.assign(Object.assign({},_.current),W(F));return f(e)?r:he(e)?d(r,e):e.map(e=>d(r,e))},ve=n.useCallback((e,r,t,n)=>{const s=Array.isArray(e),c=n||I.current?Object.assign(Object.assign({},_.current),n||W(F)):f(r)?_.current:s?r:{[e]:r};if(f(e))return t&&($.current.watchAll=!0),c;const u=[];for(const r of E(e))t&&$.current.watch.add(r),u.push(d(c,r));return s?u:u[0]},[]),pe=(e,r={})=>{for(const t of e?E(e):$.current.mount)$.current.mount.delete(t),$.current.array.delete(t),d(F.current,t)&&(!r.keepError&&se(k.current.errors,t),!r.keepValue&&se(F.current,t),!r.keepDirty&&se(k.current.dirtyFields,t),!r.keepTouched&&se(k.current.touchedFields,t),!r.keepDefaultValue&&se(_.current,t),P.current.watch.next({name:t,values:be()}));P.current.state.next(Object.assign(Object.assign({},k.current),r.keepDirty?{isDirty:Y()}:{})),!r.keepIsValid&&oe()},xe=(e,r,t)=>{Oe(e,t);let n=d(F.current,e);const c=(e=>ae(e)||s(e))(r);r===n._f.ref||c&&l(n._f.refs||[]).find(e=>e===r)||(n={_f:c?Object.assign(Object.assign({},n._f),{refs:[...l(n._f.refs||[]).filter(e=>Ae(e)&&document.contains(e)),r],ref:{type:r.type,name:e}}):Object.assign(Object.assign({},n._f),{ref:r})},L(F.current,e,n),ie(e,r))},Oe=n.useCallback((e,r={})=>{const t=d(F.current,e);return L(F.current,e,{_f:Object.assign(Object.assign(Object.assign({},t&&t._f?t._f:{ref:{name:e}}),{name:e,mount:!0}),r)}),$.current.mount.add(e),!t&&ie(e),_e?{name:e}:{name:e,onChange:de,onBlur:de,ref:t=>{if(t)xe(e,t,r);else{const t=d(F.current,e,{}),n=v||r.shouldUnregister;t._f&&(t._f.mount=!1,f(t._f.value)&&(t._f.value=t._f.ref.value)),n&&(!o($.current.array,e)||!N.current)&&$.current.unMount.add(e)}}}},[]),ke=n.useCallback((e,r)=>async n=>{n&&(n.preventDefault&&n.preventDefault(),n.persist&&n.persist());let s=!0,c=W(F);P.current.state.next({isSubmitting:!0});try{if(t){const{errors:e,values:r}=await A.current(c,T.current,ge($.current.mount,F.current,x));k.current.errors=e,c=r}else await te(F.current);S(k.current.errors)&&Object.keys(k.current.errors).every(e=>d(c,e))?(P.current.state.next({errors:{},isSubmitting:!0}),await e(c,n)):(r&&await r(k.current.errors,n),g&&U(F.current,e=>d(k.current.errors,e),$.current.mount))}catch(e){throw s=!1,e}finally{k.current.isSubmitted=!0,P.current.state.next({isSubmitted:!0,isSubmitting:!1,isSubmitSuccessful:S(k.current.errors)&&s,submitCount:k.current.submitCount+1,errors:k.current.errors})}},[g,H,x]),Fe=(e,r="")=>{for(const t in e){const n=e[t],s=r+(r?".":"")+t,c=d(F.current,s);c&&c._f||(a(n)||Array.isArray(n)?Fe(n,s):c||Oe(s,{value:n}))}};return n.useEffect(()=>{const e=P.current.state.subscribe({next(e){D(e,w.current,!0)&&(k.current=Object.assign(Object.assign({},k.current),e),j(k.current))}}),r=P.current.array.subscribe({next(e){if(e.values&&e.name&&w.current.isValid){const r=W(F);L(r,e.name,e.values),oe(r)}}});return()=>{e.unsubscribe(),r.unsubscribe()}},[]),n.useEffect(()=>{const e=e=>!Ae(e)||!document.contains(e);I.current||(I.current=!0,w.current.isValid&&oe(),!v&&Fe(_.current));for(const r of $.current.unMount){const t=d(F.current,r);t&&(t._f.refs?t._f.refs.every(e):e(t._f.ref))&&pe(r)}$.current.unMount=new Set}),{control:n.useMemo(()=>({register:Oe,inFieldArrayActionRef:N,getIsDirty:Y,subjectsRef:P,watchInternal:ve,fieldsRef:F,updateIsValid:oe,namesRef:$,readFormStateRef:w,formStateRef:k,defaultValuesRef:_,fieldArrayDefaultValuesRef:R,unregister:pe,shouldUnmount:v}),[]),formState:C(M,O,w),trigger:ne,register:Oe,handleSubmit:ke,watch:n.useCallback((e,r)=>me(e)?P.current.watch.subscribe({next:t=>e(ve(void 0,r),t)}):ve(e,r,!0),[]),setValue:n.useCallback((e,r,t={})=>{const n=d(F.current,e),s=$.current.array.has(e);s&&(P.current.array.next({values:r,name:e,isReset:!0}),(w.current.isDirty||w.current.dirtyFields)&&t.shouldDirty&&(L(k.current.dirtyFields,e,K(r,d(_.current,e,[]),d(k.current.dirtyFields,e,[]))),P.current.state.next({name:e,dirtyFields:k.current.dirtyFields,isDirty:Y(e,r)})),!r.length&&L(F.current,e,[])&&L(R.current,e,[])),(n&&!n._f||s)&&!c(r)?le(e,r,s?{}:t):X(e,r,t,!0,!n),J(e)&&P.current.state.next({}),P.current.watch.next({name:e,values:be()})},[le]),getValues:n.useCallback(be,[]),reset:n.useCallback((e,r={})=>{const t=e||_.current;if(B&&!r.keepValues)for(const e of $.current.mount){const r=d(F.current,e);if(r&&r._f){const e=Array.isArray(r._f.refs)?r._f.refs[0]:r._f.ref;try{Ae(e)&&e.closest("form").reset();break}catch(e){}}}!r.keepDefaultValues&&(_.current=Object.assign({},t)),r.keepValues||(F.current={},P.current.control.next({values:Object.assign({},t)}),P.current.watch.next({values:Object.assign({},t)}),P.current.array.next({values:Object.assign({},t),isReset:!0})),$.current={mount:new Set,unMount:new Set,array:new Set,watch:new Set,watchAll:!1},P.current.state.next({submitCount:r.keepSubmitCount?k.current.submitCount:0,isDirty:r.keepDirty?k.current.isDirty:!!r.keepDefaultValues&&G(e,_.current),isSubmitted:!!r.keepIsSubmitted&&k.current.isSubmitted,dirtyFields:r.keepDirty?k.current.dirtyFields:{},touchedFields:r.keepTouched?k.current.touchedFields:{},errors:r.keepErrors?k.current.errors:{},isSubmitting:!1,isSubmitSuccessful:!1}),I.current=!!r.keepIsValid},[]),clearErrors:n.useCallback(e=>{e?E(e).forEach(e=>se(k.current.errors,e)):k.current.errors={},P.current.state.next({errors:k.current.errors})},[]),unregister:n.useCallback(pe,[]),setError:n.useCallback((e,r,t)=>{const n=((d(F.current,e)||{_f:{}})._f||{}).ref;L(k.current.errors,e,Object.assign(Object.assign({},r),{ref:n})),P.current.state.next({name:e,errors:k.current.errors,isValid:!1}),t&&t.shouldFocus&&n&&n.focus&&n.focus()},[]),setFocus:n.useCallback(e=>d(F.current,e)._f.ref.focus(),[])}},e.useFormContext=R,e.useFormState=T,e.useWatch=function(e){const{control:r,name:t,defaultValue:s}=e||{},c=R(),u=n.useRef(t);u.current=t;const{watchInternal:a,subjectsRef:i}=r||c.control,[o,l]=n.useState(f(s)?a(t):s);return n.useEffect(()=>{a(t);const e=i.current.watch.subscribe({next:({name:e,values:r})=>(!u.current||!e||E(u.current).some(r=>e&&r&&(r.startsWith(e)||e.startsWith(r))))&&l(a(u.current,s,!1,r))});return()=>e.unsubscribe()},[]),o},Object.defineProperty(e,"__esModule",{value:!0})}));
//# sourceMappingURL=index.umd.js.map
